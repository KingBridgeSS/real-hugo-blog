<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Misc on BRIdGE&#39;s blog</title>
    <link>https://blog.kingbridge.one/tags/misc/</link>
    <description>Recent content in Misc on BRIdGE&#39;s blog</description>
    <generator>Hugo</generator>
    <language>en</language>
    <lastBuildDate>Mon, 24 Mar 2025 00:00:00 +0000</lastBuildDate>
    <atom:link href="https://blog.kingbridge.one/tags/misc/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>折腾家庭影院（如果学校也算家的话）</title>
      <link>https://blog.kingbridge.one/posts/2025_spring/%E5%9C%A82025%E5%B9%B4%E6%8A%98%E8%85%BE%E5%AE%B6%E5%BA%AD%E5%BD%B1%E9%99%A2%E5%A6%82%E6%9E%9C%E5%AD%A6%E6%A0%A1%E4%B9%9F%E7%AE%97%E5%AE%B6%E7%9A%84%E8%AF%9D/</link>
      <pubDate>Mon, 24 Mar 2025 00:00:00 +0000</pubDate>
      <guid>https://blog.kingbridge.one/posts/2025_spring/%E5%9C%A82025%E5%B9%B4%E6%8A%98%E8%85%BE%E5%AE%B6%E5%BA%AD%E5%BD%B1%E9%99%A2%E5%A6%82%E6%9E%9C%E5%AD%A6%E6%A0%A1%E4%B9%9F%E7%AE%97%E5%AE%B6%E7%9A%84%E8%AF%9D/</guid>
      <description>&lt;p&gt;最近沉迷二次元，正好捡垃圾搞到一台J3160工控机，以此作为挂载磁盘简单搞了一套“家庭”影院。&lt;/p&gt;&#xA;&lt;p&gt;需求：PT、多设备观看、加密&lt;/p&gt;&#xA;&lt;p&gt;设备：零刻SER6 MAX、J3160工控机、4T HDD硬盘&lt;/p&gt;&#xA;&lt;h1 id=&#34;框架&#34;&gt;框架&lt;/h1&gt;&#xA;&lt;p&gt;影院软件使用Jellyfin，PT使用Qbittorrent，二者都需要Docker容器化。&lt;/p&gt;&#xA;&lt;p&gt;实测J3160跑Jellyfin在烧录字幕时巨卡（拖动进度条基本10s起步），考虑仅仅把J3160作为网络存储，而用ser6max跑Jellyfin解析视频。（无端联想东数西算）&lt;/p&gt;&#xA;&lt;p&gt;Ser6Max的OpenWRT当时刷机的时候忘记搞IPV6支持，索性直接在J3160上挂PT了（PT需要开启IPV6）。&lt;/p&gt;&#xA;&lt;p&gt;毕竟是校园网而不是真家庭的内网，需要HTTPS加密一下。这里使用Caddy简单反代一下自签名HTTPS。（当然如果用tailscale可以直接端到端加密，好用爱用）&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;&#xD;&#xA;        /posts/2025_spring/assets/1742830421487-fc753de3-e023-4407-a341-e9cb8f7ea8f8.png&#34;/&gt;&lt;/p&gt;&#xA;&lt;h1 id=&#34;操作系统&#34;&gt;操作系统&lt;/h1&gt;&#xA;&lt;p&gt;Ser6Max的架构见&lt;a href=&#34;https://blog.kingbridge.one/posts/2024_fall/pveandnat/&#34;&gt;在校园网通过PVE+OpenWRT NAT接入有线网&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;J3160使用Ubuntu 24&lt;/p&gt;&#xA;&lt;h1 id=&#34;samba&#34;&gt;Samba&lt;/h1&gt;&#xA;&lt;p&gt;smb协议支持加密，并且能适配多系统。&lt;/p&gt;&#xA;&lt;h2 id=&#34;linux服务端&#34;&gt;Linux服务端&lt;/h2&gt;&#xA;&lt;p&gt;J3160上启用Samba服务&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;sudo vim /etc/samba/smb.conf&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;末尾添加&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-plain&#34; data-lang=&#34;plain&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[NetShare]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   comment = Single User Share&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   path = /mnt/data0/net&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   browseable = yes&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   writable = yes&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   valid users = [user]&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   create mask = 0644&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   directory mask = 0755&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo chown -R &lt;span style=&#34;color:#ff79c6&#34;&gt;[&lt;/span&gt;user&lt;span style=&#34;color:#ff79c6&#34;&gt;]&lt;/span&gt; /mnt/data0/net &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo smbpasswd -&lt;span style=&#34;color:#ff79c6&#34;&gt;[&lt;/span&gt;user&lt;span style=&#34;color:#ff79c6&#34;&gt;]&lt;/span&gt; password&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo systemctl restart smbd&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;linux客户端&#34;&gt;Linux客户端&lt;/h2&gt;&#xA;&lt;p&gt;&lt;code&gt;sudo vim /etc/cifs-credentials&lt;/code&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>在校园网通过PVE&#43;OpenWRT NAT接入有线网</title>
      <link>https://blog.kingbridge.one/posts/2024_fall/pveandnat/</link>
      <pubDate>Mon, 04 Nov 2024 00:00:00 +0000</pubDate>
      <guid>https://blog.kingbridge.one/posts/2024_fall/pveandnat/</guid>
      <description>&lt;p&gt;注：本篇主要讲述网络配置，PVE装机等细节懒得写了（&lt;/p&gt;&#xA;&lt;p&gt;废话：时隔一万年后一个叫bridge的fw终于想起了他的博客，决定更新。原来用的博客是xlog，但是发现主页文章卡片飘忽不定。github上有&lt;a href=&#34;https://github.com/Crossbell-Box/xLog/issues/2173&#34;&gt;很多类似的issues&lt;/a&gt;(文章末尾有反转)。正值mac-mini发售之际，周围朋友对小主机的热情似乎提高了起来。bridge看着脚下吃灰的小主机，决定用它配一个PVE用来跑博客。&lt;/p&gt;&#xA;&lt;p&gt;但是接入学校的有线网有个问题：接入的交换机有一个IP-MAC表，需要申请登记，否则不在表里会被拦截。所以Plan A：所有虚拟机全部桥接，每开一个虚拟机都找管理员登记一遍。为了防止管理员说&amp;quot;how old are you&amp;quot;，就有了Plan B。&lt;/p&gt;&#xA;&lt;p&gt;于是为了这个博客，bridge包了这样一盘饺子：&lt;/p&gt;&#xA;&lt;h1 id=&#34;网络拓扑图&#34;&gt;网络拓扑图&lt;/h1&gt;&#xA;&lt;p&gt;&lt;img src=&#34;&#xD;&#xA;        /posts/2024_fall/assets/1730736611574-682f5fe3-0e26-47e4-827f-df0a709e240d.jpeg&#34;/&gt;&lt;/p&gt;&#xA;&lt;p&gt;OpenWRT作为软路由，用SNAT给PVE里的虚拟机开了一个内网，这样在出网的时候都用的是OpenWRT的IP-MAC。内网设备通过PVE的vmbr1桥接网络连在一起，而vmbr0连接了OpenWRT和物理网卡。&lt;/p&gt;&#xA;&lt;p&gt;怎么从外部管理内部虚拟机？这里我在OpenWRT上装了一个tailscale，开启子网转发。&lt;/p&gt;&#xA;&lt;p&gt;博客怎么弄到公网？我使用了cloudflare的TUN，它相当于一个反向代理，可以直接把&lt;code&gt;blog.queenbridge.tech&lt;/code&gt;转发到探针（cloudflared container）上，然后探针向内网请求再发给公网。&lt;/p&gt;&#xA;&lt;h1 id=&#34;搭建过程一些坑&#34;&gt;搭建过程&amp;amp;&amp;amp;一些坑&lt;/h1&gt;&#xA;&lt;h2 id=&#34;pve&#34;&gt;PVE&lt;/h2&gt;&#xA;&lt;p&gt;最原始的情况下，我们只有一个PVE，如果按照最终的拓扑我的laptop根本没办法连上管理端口。所以在OpenWRT配置完成之前有两种办法：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;把laptop和PVE都连到交换机上，PVE和laptop的有线口网关设成校园网的网关&lt;/li&gt;&#xA;&lt;li&gt;干脆把直接laptop和PVE用一根网线连起来&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;首先给PVE添加两个桥接网络，vmbr0桥接到物理有线网卡enp1s0上用于通过交换机连校园网，vmbr1用作内网广播域。&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;&#xD;&#xA;        /posts/2024_fall/assets/1730738897489-a0654c93-faa4-44fe-b458-5ac519891d94.png&#34;/&gt;&lt;/p&gt;&#xA;&lt;p&gt;登录PVE，最终/etc/network/interfaces的配置如下&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;auto lo&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;iface lo inet loopback&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;iface enp1s0 inet manual&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;iface wlp2s0 inet manual&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;auto vmbr0&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;iface vmbr0 inet static&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        address &lt;span style=&#34;color:#bd93f9&#34;&gt;10&lt;/span&gt;.X.X.X/&lt;span style=&#34;color:#bd93f9&#34;&gt;24&lt;/span&gt;  &lt;span style=&#34;color:#6272a4&#34;&gt;# 校园网IP&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;bridge-ports&lt;/span&gt; enp1s0&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;bridge-stp&lt;/span&gt; off&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#8be9fd;font-style:italic&#34;&gt;bridge-fd&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;auto vmbr1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;iface vmbr1 inet static&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        address &lt;span style=&#34;color:#bd93f9&#34;&gt;192.168&lt;/span&gt;.233.&lt;span style=&#34;color:#bd93f9&#34;&gt;10&lt;/span&gt;/&lt;span style=&#34;color:#bd93f9&#34;&gt;24&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        gateway &lt;span style=&#34;color:#bd93f9&#34;&gt;192.168&lt;/span&gt;.233.1&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        bridge_ports none&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        bridge_stp off&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        bridge_fd &lt;span style=&#34;color:#bd93f9&#34;&gt;0&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;source /etc/network/interfaces.d/*&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;立即使用配置：&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
